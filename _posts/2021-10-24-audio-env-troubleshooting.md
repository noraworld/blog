---
layout: post
title: "音響周りのトラブルシューティング"
image: ""
date: "2021-10-24 19:05:24"
tags:
published: false
---

# ことの発端
今日の 18 時台に、Mac や Raspberry Pi や Fire TV の音声がガサガサになってしまった。

数日くらい前に Mac につないでいたオーディオインターフェースが音を拾ってくれなくなる問題が発生した。原因は不明。この現象は今回が初である。

結局この問題は、USB を抜き差しすることで解決できたのだが、数日前に発生したこともあり、今回の問題もこれに起因していると思いこんでしまった。

しかし、今回は USB を抜き差ししても変わらず。そして Raspberry Pi や Fire TV のほうでも同様の問題が発生していることがわかった。

そして、こちらに関しても心当たりがあった。Raspberry Pi 上の PulseAudio に音声を集約する設定を構築している間にも似たような現象が発生していたことを思い出した。

結局、この問題については解決できなくて、仕方なく Ubuntu を再インストールすることで解決した。

またこの問題が発生してしまったのではないかと思い憂鬱な気分になっていたが、もう少しよく調査してみることにした。

Mac と Raspberry Pi と Fire TV などの HDMI 機器と Bluetooth トランスミッターは、すべてつながっている。つまり、どこに問題があるのかはまだわからないのだ。そこで、それぞれを分離して一つずつ原因の元を調べてみることにした。

Mac と Bluetooth トランスミッターだけをつないでもこの現象が発生する。そして Raspberry Pi だけをつないでも同じだった。

ここまで来てようやく、Mac や Raspberry Pi ではなく Bluetooth トランスミッターに問題があることに気づいた。

文章に起こすと簡単なことのように感じるが、これに気づくまでに 1 時間ほどかかった。

そこで今回は、このように無駄な時間を食わなくて済むように、音響周りで問題が発生した際のトラブルシューティングを個人的にまとめようと思う。

これは完全に個人的なメモとなるが、読者の方の何かの参考になれば幸いだ。



# トラブルシューティング
1. Bluetooth トランスミッターを疑う
2. 音声分離器を疑う
3. Mac を疑う
4. Raspberry Pi を疑う

## Bluetooth トランスミッターを疑う
### 発生しうる症状
* 音がガサガサになる
* 音飛びが発生する

### 確認方法
* 単体の音声をトランスミッターにつないでみる
    * ただし、その単体の音声ソースがおかしい可能性も否定できないので、以下のようにいくつかの音声ソースを単体でつないでみて確認すると良いだろう

確認パターンは以下の通り。

* Fire TV などの HDMI 音声
    * 音声分離器の S/PDIF をそのままトランスミッターにつなぐ
* Mac
    * Mac につないでいるオーディオインターフェースの S/PDIF をそのままトランスミッターにつなぐ
* Raspberry Pi
    * Raspberry Pi につないでいるオーディオインターフェースの S/PDIF をそのままトランスミッターにつなぐ

### 解決方法
* 一度ヘッドフォンの電源を切り Bluetooth 接続を解除し、その後、1 分ほど待ち、もう一度ヘッドフォンの電源を入れ接続する

ぶっちゃけ確認を取る前にこれをやってしまえば良いような気がする……。

### 備考
結局これが今回の原因だった。

自宅にある Bluetooth トランスミッターは、TaoTronics の TT-BA09 というものだ。

このトランスミッターは、ヘッドフォンとの接続を切ったあと、すぐにもう一度接続しようとすると、今回の現象が発生する。これはこの製品の不具合なのか、それとも不良品を引いてしまったのかは定かではない。

筆者はヘッドフォンを 2 台使っているので、片方のヘッドフォンの電源を切ったあと、もう片方の電源をすぐに入れて接続されると頻繁にこの問題が発生することを前から認識していた。

1 分くらい待てば大丈夫なので、正直あまり困るとは思っていなかった。しかし今回はなぜかそこに考えが思い至らなかった。何度も確認していることなのに、なぜか頭からすっぽりと考慮が抜けていた。

Amazon のリンクを貼ろうと思ったら販売終了していた。やはり欠陥品だったのか……？

とにかく、まずは Bluetooth トランスミッターが問題かどうかを確認する。

## 音声分離器を疑う
### 発生しうる症状
* (問題が発生したことがない)

### 確認方法
* 音声分離器の S/PDIF をそのままトランスミッターにつなぎ、HDMI 機器の音声が聞こえるか確認する
    * ただし、その上流に存在する HDMI 切替器が問題の可能性があるので、単体の HDMI 機器につなぎ替えるとより良いだろう
    * Fire TV で確認するのが良さそうだが、それで問題が発生していると考えられるならば、念のため Nintendo Switch でも確認すると確実

### 解決方法
* 一度、電源を切ってみて、1 分後、もう一度電源を入れてみる
* HDMI ケーブルを抜き差ししてみる

### 備考
音声分離器が問題になったことは今のところ一度もないのだが、音声を担う機器としては、ここに問題があるかもしれないということを考慮に入れなければならない。

数日前に Mac に接続しているオーディオインターフェースで音が拾えなくなったときも、それを疑って音声を分離器が問題ないか確認していた。

## Mac を疑う
### 発生しうる症状
* 音が何も聞こえなくなる

### 確認方法
* Mac に接続しているオーディオインターフェースの S/PDIF の `SYNC` ランプがついているか確認する

### 解決方法
* 一度 Mac とオーディオインターフェースの USB 端子を抜き、数秒後、もう一度接続する

### 備考
数日前に、Mac に接続しているオーディオインターフェースを経由すると、すべての音声が聞こえなくなる現象が発生したので、これも疑う必要があるだろう。

今まではこんなことは起こったことがなく数日前に初めて発生したので、正直何が原因なのかはわかっていない。

## Raspberry Pi を疑う
### 発生しうる症状
* 音がガサガサになる
* 音飛びが発生する
* 音が何も聞こえなくなる

### 確認方法
* Raspberry Pi とトランスミッターを直接接続し、Raspberry Pi から音を流してみる

```shell:Shell
marlin play
ojt テスト
```

### 解決方法
* デーモンがちゃんと起動しているか確認する
* PulseAudio の設定が間違っていないかなどを確認する
* とりあえず再起動してみて、問題が解決するかどうか確かめてみる

```shell:Shell
marlin health
pacmd list-sinks
```

### 備考
正直ここまで来ると結構厄介だ。

PulseAudio は謎の不具合が急に発生することがあるので、ここに原因があるとすると、正直どう解決したら良いかわからない。

前は Ubuntu を再インストールする羽目になったが、正直ここまではしたくない。
